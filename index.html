<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØµÙˆØµ - Text Diff Checker</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
        }
        
        .added {
            background-color: #d4edda;
            color: #155724;
            padding: 2px 4px;
            border-radius: 3px;
            display: inline;
        }
        
        .removed {
            background-color: #f8d7da;
            color: #721c24;
            padding: 2px 4px;
            border-radius: 3px;
            text-decoration: line-through;
            display: inline;
        }
        
        .changed {
            background-color: #fff3cd;
            color: #856404;
            padding: 2px 4px;
            border-radius: 3px;
            display: inline;
        }
        
        .result-box {
            min-height: 150px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 2;
        }
        
        textarea {
            resize: vertical;
            white-space: pre-wrap;
        }
        
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .view-tab-active {
            border-bottom: 3px solid #667eea;
            color: #667eea;
            font-weight: bold;
        }
        
        .split-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        @media (max-width: 768px) {
            .split-view {
                grid-template-columns: 1fr;
            }
        }
        
        .old-text-box {
            border-right: 4px solid #dc3545;
        }
        
        .new-text-box {
            border-right: 4px solid #28a745;
        }
        
        .line-number {
            color: #999;
            margin-left: 10px;
            user-select: none;
            min-width: 30px;
            display: inline-block;
            text-align: left;
        }
        
        .diff-line {
            padding: 2px 0;
            display: block;
        }
        
        .diff-line:hover {
            background-color: #f0f0f0;
        }
        
        .placeholder-text {
            color: #999;
            font-style: italic;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center">ğŸ” Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØµÙˆØµ</h1>
            <p class="text-center mt-2 opacity-90">Ø§ÙƒØªØ´Ù Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Mode Selection -->
        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg p-1 shadow-md inline-flex">
                <button id="mode2" onclick="switchMode(2)" class="tab-active px-6 py-3 rounded-lg font-medium transition-all duration-300">
                    Ù…Ù‚Ø§Ø±Ù†Ø© Ù†ØµÙŠÙ†
                </button>
                <button id="mode4" onclick="switchMode(4)" class="px-6 py-3 rounded-lg font-medium transition-all duration-300 hover:bg-gray-100">
                    Ù…Ù‚Ø§Ø±Ù†Ø© 4 Ù†ØµÙˆØµ
                </button>
            </div>
        </div>

        <!-- Input Section for 2 Texts -->
        <div id="input2" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <label class="block text-lg font-bold text-gray-700 mb-3">
                    <span class="inline-block w-8 h-8 bg-blue-500 text-white rounded-full text-center leading-8 ml-2">1</span>
                    Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø£ØµÙ„ÙŠ)
                </label>
                <textarea id="text1" rows="8" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ Ù‡Ù†Ø§..."></textarea>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <label class="block text-lg font-bold text-gray-700 mb-3">
                    <span class="inline-block w-8 h-8 bg-green-500 text-white rounded-full text-center leading-8 ml-2">2</span>
                    Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø§Ù„Ù…Ø¹Ø¯Ù„)
                </label>
                <textarea id="text2" rows="8" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù†ÙŠ Ù‡Ù†Ø§..."></textarea>
            </div>
        </div>

        <!-- Input Section for 4 Texts -->
        <div id="input4" class="hidden grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <label class="block text-lg font-bold text-gray-700 mb-3">
                    <span class="inline-block w-8 h-8 bg-blue-500 text-white rounded-full text-center leading-8 ml-2">1</span>
                    Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„
                </label>
                <textarea id="text1_4" rows="6" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„..."></textarea>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <label class="block text-lg font-bold text-gray-700 mb-3">
                    <span class="inline-block w-8 h-8 bg-green-500 text-white rounded-full text-center leading-8 ml-2">2</span>
                    Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù†ÙŠ
                </label>
                <textarea id="text2_4" rows="6" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù†ÙŠ..."></textarea>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <label class="block text-lg font-bold text-gray-700 mb-3">
                    <span class="inline-block w-8 h-8 bg-yellow-500 text-white rounded-full text-center leading-8 ml-2">3</span>
                    Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù„Ø«
                </label>
                <textarea id="text3_4" rows="6" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù„Ø«..."></textarea>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <label class="block text-lg font-bold text-gray-700 mb-3">
                    <span class="inline-block w-8 h-8 bg-red-500 text-white rounded-full text-center leading-8 ml-2">4</span>
                    Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø§Ø¨Ø¹
                </label>
                <textarea id="text4_4" rows="6" class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø§Ø¨Ø¹..."></textarea>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-center gap-4 mb-8">
            <button onclick="compareTexts()" class="gradient-bg text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                ğŸ” Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØµÙˆØµ
            </button>
            <button onclick="clearAll()" class="bg-gray-500 text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:bg-gray-600 transition-all duration-300">
                ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
            </button>
            <button onclick="loadExample('ar')" class="bg-amber-500 text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:bg-amber-600 transition-all duration-300">
                ğŸ“ Ù…Ø«Ø§Ù„ Ø¹Ø±Ø¨ÙŠ
            </button>
            <button onclick="loadExample('en')" class="bg-teal-500 text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:bg-teal-600 transition-all duration-300">
                ğŸ“ English Example
            </button>
        </div>

        <!-- Legend -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-6">
            <h3 class="font-bold text-gray-700 mb-3 text-center">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h3>
            <div class="flex flex-wrap justify-center gap-6">
                <div class="flex items-center gap-2">
                    <span class="added px-3 py-1">Ù†Øµ Ù…Ø¶Ø§Ù</span>
                    <span class="text-gray-600">= Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø·</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="removed px-3 py-1">Ù†Øµ Ù…Ø­Ø°ÙˆÙ</span>
                    <span class="text-gray-600">= Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙ‚Ø·</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="changed px-3 py-1">Ù†Øµ Ù…Ø®ØªÙ„Ù</span>
                    <span class="text-gray-600">= ØªØºÙŠÙŠØ± Ø¨ÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ</span>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</h2>
            
            <!-- Statistics -->
            <div id="stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-xl shadow p-4 text-center">
                    <div class="text-3xl font-bold text-blue-500" id="totalWords">0</div>
                    <div class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</div>
                </div>
                <div class="bg-white rounded-xl shadow p-4 text-center">
                    <div class="text-3xl font-bold text-green-500" id="addedCount">0</div>
                    <div class="text-gray-600">ÙƒÙ„Ù…Ø§Øª Ù…Ø¶Ø§ÙØ©</div>
                </div>
                <div class="bg-white rounded-xl shadow p-4 text-center">
                    <div class="text-3xl font-bold text-red-500" id="removedCount">0</div>
                    <div class="text-gray-600">ÙƒÙ„Ù…Ø§Øª Ù…Ø­Ø°ÙˆÙØ©</div>
                </div>
                <div class="bg-white rounded-xl shadow p-4 text-center">
                    <div class="text-3xl font-bold text-purple-500" id="similarityPercent">0%</div>
                    <div class="text-gray-600">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ´Ø§Ø¨Ù‡</div>
                </div>
            </div>

            <!-- View Toggle for 2-text mode -->
            <div id="viewToggle" class="flex justify-center mb-6">
                <div class="bg-white rounded-lg p-1 shadow-md inline-flex">
                    <button id="viewCombined" onclick="switchView('combined')" class="view-tab-active px-5 py-2 rounded-lg font-medium transition-all duration-300 border-b-3">
                        ğŸ“„ Ø¹Ø±Ø¶ Ù…ÙˆØ­Ø¯
                    </button>
                    <button id="viewSplit" onclick="switchView('split')" class="px-5 py-2 rounded-lg font-medium transition-all duration-300 hover:bg-gray-100">
                        ğŸ“‘ Ø¹Ø±Ø¶ Ù…Ù†Ù‚Ø³Ù…
                    </button>
                </div>
            </div>

            <!-- Diff Results -->
            <div id="diffResults" class="grid grid-cols-1 gap-6"></div>
            
            <!-- Split View Results -->
            <div id="splitResults" class="hidden">
                <div class="split-view">
                    <!-- Right Side - Old Text (Red) -->
                    <div class="bg-white rounded-xl shadow-lg p-6 old-text-box">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="inline-block w-4 h-4 bg-red-500 rounded-full"></span>
                            <h3 class="font-bold text-lg text-red-700">Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ (Ø§Ù„Ù‚Ø¯ÙŠÙ…)</h3>
                        </div>
                        <div class="text-sm text-gray-500 mb-3">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ù…Ù…ÙŠØ²Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±</div>
                        <div id="oldTextResult" class="result-box bg-red-50 rounded-lg p-4 border-2 border-red-200"></div>
                    </div>
                    <!-- Left Side - New Text (Green) -->
                    <div class="bg-white rounded-xl shadow-lg p-6 new-text-box">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="inline-block w-4 h-4 bg-green-500 rounded-full"></span>
                            <h3 class="font-bold text-lg text-green-700">Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ù„Ù…Ø¹Ø¯Ù„)</h3>
                        </div>
                        <div class="text-sm text-gray-500 mb-3">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù…Ù…ÙŠØ²Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø±</div>
                        <div id="newTextResult" class="result-box bg-green-50 rounded-lg p-4 border-2 border-green-200"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-4 mt-8">
        <div class="container mx-auto text-center">
            <p>Ø£Ø¯Ø§Ø© Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØµÙˆØµ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2024</p>
        </div>
    </footer>

    <script>
        let currentMode = 2;
        let currentView = 'combined';
        let lastDiffResult = null;
        let lastText1 = '';
        let lastText2 = '';

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        function detectTextDirection(text) {
            if (!text || !text.trim()) return 'rtl';
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„
            const cleanText = text.replace(/[\d\s\.,!?;:'"()\[\]{}<>@#$%^&*+=\-_\\|\/`~]/g, '');
            
            if (!cleanText) return 'rtl';
            
            // Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¹Ø¨Ø±ÙŠØ© (RTL)
            const rtlChars = /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF\u0590-\u05FF]/;
            // Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ù„Ø§ØªÙŠÙ†ÙŠØ© (LTR)
            const ltrChars = /[A-Za-z\u00C0-\u024F\u1E00-\u1EFF]/;
            
            let rtlCount = 0;
            let ltrCount = 0;
            
            for (let i = 0; i < Math.min(cleanText.length, 100); i++) {
                const char = cleanText[i];
                if (rtlChars.test(char)) rtlCount++;
                else if (ltrChars.test(char)) ltrCount++;
            }
            
            return rtlCount >= ltrCount ? 'rtl' : 'ltr';
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ Ø¹Ù„Ù‰ Ø¹Ù†ØµØ±
        function applyTextDirection(element, text) {
            const direction = detectTextDirection(text);
            element.setAttribute('dir', direction);
            element.style.textAlign = direction === 'rtl' ? 'right' : 'left';
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        function setupAutoDirection() {
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
                textarea.addEventListener('input', function() {
                    applyTextDirection(this, this.value);
                });
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ù„ØµÙ‚
                textarea.addEventListener('paste', function() {
                    setTimeout(() => {
                        applyTextDirection(this, this.value);
                    }, 10);
                });
            });
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', setupAutoDirection);

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('mode2').classList.toggle('tab-active', mode === 2);
            document.getElementById('mode4').classList.toggle('tab-active', mode === 4);
            document.getElementById('input2').classList.toggle('hidden', mode !== 2);
            document.getElementById('input4').classList.toggle('hidden', mode !== 4);
            document.getElementById('results').classList.add('hidden');
        }

        function switchView(view) {
            currentView = view;
            document.getElementById('viewCombined').classList.toggle('view-tab-active', view === 'combined');
            document.getElementById('viewSplit').classList.toggle('view-tab-active', view === 'split');
            document.getElementById('diffResults').classList.toggle('hidden', view === 'split');
            document.getElementById('splitResults').classList.toggle('hidden', view === 'combined');
            
            if (view === 'split' && lastDiffResult) {
                renderSplitView(lastDiffResult, lastText1, lastText2);
            }
        }

        // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø£Ø³Ø·Ø±
        function tokenize(text) {
            const tokens = [];
            let current = '';
            let isSpace = false;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const charIsSpace = /\s/.test(char);
                
                if (tokens.length === 0) {
                    current = char;
                    isSpace = charIsSpace;
                } else if (charIsSpace === isSpace) {
                    current += char;
                } else {
                    tokens.push({ text: current, isSpace });
                    current = char;
                    isSpace = charIsSpace;
                }
            }
            
            if (current) {
                tokens.push({ text: current, isSpace });
            }
            
            return tokens;
        }

        function getWords(text) {
            return text.trim().split(/\s+/).filter(w => w.length > 0);
        }

        // Longest Common Subsequence for diff
        function lcs(arr1, arr2) {
            const m = arr1.length;
            const n = arr2.length;
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (arr1[i - 1] === arr2[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                    }
                }
            }

            // Backtrack to find LCS
            const result = [];
            let i = m, j = n;
            while (i > 0 && j > 0) {
                if (arr1[i - 1] === arr2[j - 1]) {
                    result.unshift({ word: arr1[i - 1], i1: i - 1, i2: j - 1 });
                    i--;
                    j--;
                } else if (dp[i - 1][j] > dp[i][j - 1]) {
                    i--;
                } else {
                    j--;
                }
            }
            return result;
        }

        function diffTexts(text1, text2) {
            const words1 = getWords(text1);
            const words2 = getWords(text2);
            const common = lcs(words1, words2);
            
            const result = [];
            let idx1 = 0, idx2 = 0, commonIdx = 0;
            
            let added = 0, removed = 0;

            while (idx1 < words1.length || idx2 < words2.length) {
                if (commonIdx < common.length) {
                    const c = common[commonIdx];
                    
                    // Add removed words from text1
                    while (idx1 < c.i1) {
                        result.push({ word: words1[idx1], type: 'removed' });
                        removed++;
                        idx1++;
                    }
                    
                    // Add added words from text2
                    while (idx2 < c.i2) {
                        result.push({ word: words2[idx2], type: 'added' });
                        added++;
                        idx2++;
                    }
                    
                    // Add common word
                    result.push({ word: c.word, type: 'same' });
                    idx1++;
                    idx2++;
                    commonIdx++;
                } else {
                    // Remaining words
                    while (idx1 < words1.length) {
                        result.push({ word: words1[idx1], type: 'removed' });
                        removed++;
                        idx1++;
                    }
                    while (idx2 < words2.length) {
                        result.push({ word: words2[idx2], type: 'added' });
                        added++;
                        idx2++;
                    }
                }
            }

            return { diff: result, added, removed, total: words1.length + words2.length };
        }

        function renderDiff(diff) {
            return diff.map(item => {
                if (item.type === 'added') {
                    return `<span class="added">${escapeHtml(item.word)}</span>`;
                } else if (item.type === 'removed') {
                    return `<span class="removed">${escapeHtml(item.word)}</span>`;
                } else if (item.type === 'changed') {
                    return `<span class="changed">${escapeHtml(item.word)}</span>`;
                }
                return escapeHtml(item.word);
            }).join(' ');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function calculateSimilarity(text1, text2) {
            const words1 = new Set(getWords(text1));
            const words2 = new Set(getWords(text2));
            const intersection = [...words1].filter(w => words2.has(w)).length;
            const union = new Set([...words1, ...words2]).size;
            return union === 0 ? 100 : Math.round((intersection / union) * 100);
        }

        // Ø¹Ø±Ø¶ Ù…Ù†Ù‚Ø³Ù… Ù„Ù„Ù†Øµ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯
        function renderSplitView(diff, text1, text2) {
            const oldTextResult = document.getElementById('oldTextResult');
            const newTextResult = document.getElementById('newTextResult');
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù…Ø¹ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø­Ø°ÙˆÙ
            let oldHtml = '';
            let newHtml = '';
            
            diff.forEach(item => {
                if (item.type === 'removed') {
                    oldHtml += `<span class="removed">${escapeHtml(item.word)}</span> `;
                } else if (item.type === 'added') {
                    newHtml += `<span class="added">${escapeHtml(item.word)}</span> `;
                } else {
                    oldHtml += escapeHtml(item.word) + ' ';
                    newHtml += escapeHtml(item.word) + ' ';
                }
            });
            
            oldTextResult.innerHTML = oldHtml || '<span class="placeholder-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ</span>';
            newTextResult.innerHTML = newHtml || '<span class="placeholder-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ</span>';
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ Ø¹Ù„Ù‰ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            applyTextDirection(oldTextResult, text1);
            applyTextDirection(newTextResult, text2);
        }

        // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØµÙˆØµ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
        function diffTextsWithSpaces(text1, text2) {
            const tokens1 = tokenize(text1);
            const tokens2 = tokenize(text2);
            
            const words1 = tokens1.filter(t => !t.isSpace).map(t => t.text);
            const words2 = tokens2.filter(t => !t.isSpace).map(t => t.text);
            
            const common = lcs(words1, words2);
            
            const result = [];
            let idx1 = 0, idx2 = 0, commonIdx = 0;
            let added = 0, removed = 0;

            while (idx1 < words1.length || idx2 < words2.length) {
                if (commonIdx < common.length) {
                    const c = common[commonIdx];
                    
                    while (idx1 < c.i1) {
                        result.push({ word: words1[idx1], type: 'removed' });
                        removed++;
                        idx1++;
                    }
                    
                    while (idx2 < c.i2) {
                        result.push({ word: words2[idx2], type: 'added' });
                        added++;
                        idx2++;
                    }
                    
                    result.push({ word: c.word, type: 'same' });
                    idx1++;
                    idx2++;
                    commonIdx++;
                } else {
                    while (idx1 < words1.length) {
                        result.push({ word: words1[idx1], type: 'removed' });
                        removed++;
                        idx1++;
                    }
                    while (idx2 < words2.length) {
                        result.push({ word: words2[idx2], type: 'added' });
                        added++;
                        idx2++;
                    }
                }
            }

            return { diff: result, added, removed, total: words1.length + words2.length };
        }

        function compareTexts() {
            const resultsDiv = document.getElementById('results');
            const diffResultsDiv = document.getElementById('diffResults');
            diffResultsDiv.innerHTML = '';

            if (currentMode === 2) {
                const text1 = document.getElementById('text1').value;
                const text2 = document.getElementById('text2').value;

                if (!text1.trim() || !text2.trim()) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØµÙŠÙ† Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©');
                    return;
                }

                const { diff, added, removed, total } = diffTexts(text1, text2);
                const similarity = calculateSimilarity(text1, text2);

                // Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ù‚Ø³Ù…
                lastDiffResult = diff;
                lastText1 = text1;
                lastText2 = text2;

                document.getElementById('totalWords').textContent = total;
                document.getElementById('addedCount').textContent = added;
                document.getElementById('removedCount').textContent = removed;
                document.getElementById('similarityPercent').textContent = similarity + '%';

                // Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù†ØµÙŠÙ†
                document.getElementById('viewToggle').classList.remove('hidden');

                // ØªØ­Ø¯ÙŠØ¯ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ù…Ø¬
                const combinedDirection = detectTextDirection(text1 + ' ' + text2);
                
                diffResultsDiv.innerHTML = `
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-lg text-gray-700 mb-4">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ</h3>
                        <div class="result-box bg-gray-50 rounded-lg p-4 border-2 border-gray-200" dir="${combinedDirection}" style="text-align: ${combinedDirection === 'rtl' ? 'right' : 'left'}">${renderDiff(diff)}</div>
                    </div>
                `;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ù‚Ø³Ù…
                renderSplitView(diff, text1, text2);

                // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶
                if (currentView === 'split') {
                    document.getElementById('diffResults').classList.add('hidden');
                    document.getElementById('splitResults').classList.remove('hidden');
                } else {
                    document.getElementById('diffResults').classList.remove('hidden');
                    document.getElementById('splitResults').classList.add('hidden');
                }
            } else {
                // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ÙÙŠ ÙˆØ¶Ø¹ 4 Ù†ØµÙˆØµ
                document.getElementById('viewToggle').classList.add('hidden');
                document.getElementById('splitResults').classList.add('hidden');
                document.getElementById('diffResults').classList.remove('hidden');
                const texts = [
                    document.getElementById('text1_4').value,
                    document.getElementById('text2_4').value,
                    document.getElementById('text3_4').value,
                    document.getElementById('text4_4').value
                ];

                const nonEmpty = texts.filter(t => t.trim()).length;
                if (nonEmpty < 2) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†ØµÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©');
                    return;
                }

                let totalAdded = 0, totalRemoved = 0, totalWords = 0;
                const comparisons = [];
                const labels = ['Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ø§Ù„Ø«Ø§Ù„Ø«', 'Ø§Ù„Ø±Ø§Ø¨Ø¹'];
                const colors = ['blue', 'green', 'yellow', 'red'];

                // Compare each pair
                for (let i = 0; i < 4; i++) {
                    for (let j = i + 1; j < 4; j++) {
                        if (texts[i].trim() && texts[j].trim()) {
                            const { diff, added, removed, total } = diffTexts(texts[i], texts[j]);
                            totalAdded += added;
                            totalRemoved += removed;
                            totalWords += total;
                            comparisons.push({
                                label: `Ø§Ù„Ù†Øµ ${labels[i]} â†” Ø§Ù„Ù†Øµ ${labels[j]}`,
                                diff,
                                similarity: calculateSimilarity(texts[i], texts[j]),
                                color1: colors[i],
                                color2: colors[j]
                            });
                        }
                    }
                }

                const avgSimilarity = comparisons.length > 0 
                    ? Math.round(comparisons.reduce((a, b) => a + b.similarity, 0) / comparisons.length)
                    : 0;

                document.getElementById('totalWords').textContent = totalWords;
                document.getElementById('addedCount').textContent = totalAdded;
                document.getElementById('removedCount').textContent = totalRemoved;
                document.getElementById('similarityPercent').textContent = avgSimilarity + '%';

                comparisons.forEach((comp, index) => {
                    // ØªØ­Ø¯ÙŠØ¯ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                    const compTexts = texts.filter(t => t.trim());
                    const compDirection = detectTextDirection(compTexts.join(' '));
                    
                    const div = document.createElement('div');
                    div.className = 'bg-white rounded-xl shadow-lg p-6';
                    div.innerHTML = `
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-lg text-gray-700">${comp.label}</h3>
                            <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-medium">
                                Ø§Ù„ØªØ´Ø§Ø¨Ù‡: ${comp.similarity}%
                            </span>
                        </div>
                        <div class="result-box bg-gray-50 rounded-lg p-4 border-2 border-gray-200" dir="${compDirection}" style="text-align: ${compDirection === 'rtl' ? 'right' : 'left'}">${renderDiff(comp.diff)}</div>
                    `;
                    diffResultsDiv.appendChild(div);
                });
            }

            resultsDiv.classList.remove('hidden');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function clearAll() {
            document.getElementById('text1').value = '';
            document.getElementById('text2').value = '';
            document.getElementById('text1_4').value = '';
            document.getElementById('text2_4').value = '';
            document.getElementById('text3_4').value = '';
            document.getElementById('text4_4').value = '';
            document.getElementById('results').classList.add('hidden');
        }

        function loadExample(lang = 'ar') {
            const text1El = currentMode === 2 ? document.getElementById('text1') : document.getElementById('text1_4');
            const text2El = currentMode === 2 ? document.getElementById('text2') : document.getElementById('text2_4');
            
            if (lang === 'ar') {
                if (currentMode === 2) {
                    document.getElementById('text1').value = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ÙˆÙ‚Ø¹Ù†Ø§ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯.
Ù†Ø­Ù† Ø³Ø¹Ø¯Ø§Ø¡ Ø¨Ø²ÙŠØ§Ø±ØªÙƒÙ… ÙˆÙ†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… ØªØ¬Ø±Ø¨Ø© Ù…Ù…ØªØ¹Ø©.

Ø®Ø¯Ù…Ø§ØªÙ†Ø§ ØªØ´Ù…Ù„:
- Ø§Ù„ØªØµÙ…ÙŠÙ…
- Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©
- Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ`;
                    document.getElementById('text2').value = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ÙˆÙ‚Ø¹Ù†Ø§ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù…Ø·ÙˆØ±.
Ù†Ø­Ù† Ø³Ø¹Ø¯Ø§Ø¡ Ø¬Ø¯Ø§Ù‹ Ø¨Ø²ÙŠØ§Ø±ØªÙƒÙ… ÙˆÙ†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… ØªØ¬Ø±Ø¨Ø© Ø±Ø§Ø¦Ø¹Ø© ÙˆÙ…Ù…ÙŠØ²Ø©.

Ø®Ø¯Ù…Ø§ØªÙ†Ø§ Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø© ØªØ´Ù…Ù„:
- Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ
- Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
- Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…ØªÙˆØ§ØµÙ„
- Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª`;
                    applyTextDirection(document.getElementById('text1'), document.getElementById('text1').value);
                    applyTextDirection(document.getElementById('text2'), document.getElementById('text2').value);
                } else {
                    document.getElementById('text1_4').value = 'Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù‡ÙŠ ÙÙ† ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù„Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª.';
                    document.getElementById('text2_4').value = 'Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù‡ÙŠ Ø¹Ù„Ù… ÙˆÙÙ† ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù„Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©.';
                    document.getElementById('text3_4').value = 'Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù‡ÙŠ Ù…Ù‡Ø§Ø±Ø© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬.';
                    document.getElementById('text4_4').value = 'Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù‡ÙŠ ÙÙ† ÙˆØ¹Ù„Ù… ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù„Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª.';
                    ['text1_4', 'text2_4', 'text3_4', 'text4_4'].forEach(id => {
                        const el = document.getElementById(id);
                        applyTextDirection(el, el.value);
                    });
                }
            } else {
                if (currentMode === 2) {
                    document.getElementById('text1').value = `Welcome to our new website.
We are happy to have you here and wish you a pleasant experience.

Our services include:
- Design
- Programming
- Technical Support`;
                    document.getElementById('text2').value = `Welcome to our new and improved digital platform.
We are very happy to have you here and wish you an amazing and unique experience.

Our premium services include:
- Creative Design
- Advanced Programming
- Continuous Technical Support
- Consulting`;
                    applyTextDirection(document.getElementById('text1'), document.getElementById('text1').value);
                    applyTextDirection(document.getElementById('text2'), document.getElementById('text2').value);
                } else {
                    document.getElementById('text1_4').value = 'Programming is the art of writing code to solve problems.';
                    document.getElementById('text2_4').value = 'Programming is the science and art of writing code to solve complex problems.';
                    document.getElementById('text3_4').value = 'Programming is the skill of writing code to create software.';
                    document.getElementById('text4_4').value = 'Programming is the art and science of writing code to solve problems and build applications.';
                    ['text1_4', 'text2_4', 'text3_4', 'text4_4'].forEach(id => {
                        const el = document.getElementById(id);
                        applyTextDirection(el, el.value);
                    });
                }
            }
        }
    </script>
</body>
</html>
